



**Тестовое задание**

**Постановка задачи**:

1) Реализовать на языке программирования Java и фреймворке Spring микросервисы для предоставления возможностей пользователям покупать транспортные билеты.
1) Задание состоит из основной задачи и дополнительных задач, призванных показать степень владения теми или иными технологиями. Выполнение дополнительных задач не обязательно, но будет плюсом.
1) Реализация может допускать различные вариации. Цель задания – показать уровень владения технологиями, а не скрупулёзное следование техническому заданию.
1) Необходимо реализовать только бэкенд часть (Java микросервисы). Фронтенд часть реализовывать не нужно.
1) Исходный код должен быть опубликован на Github/Gitlab/Bitbucket.
1) Сборка – Maven или Gradle.
1) **Срок выполнения**: две недели.

**Основная задача:**

1) Реализовать микросервис с REST интерфейсом, который будет обрабатывать заявки на покупку билетов.
1) Основные сущности:
    1. **Билет** – право проезда по определенному маршруту в определенную дату и место в транспортном средстве. Атрибуты: маршрут, дата/время, номер места, цена.
    1. **Маршрут** – определенный путь движения. Атрибуты: пункт отправления, пункт назначения, перевозчик, длительность в минутах.
    1. **Перевозчик** – компания, осуществляющая перевозки. Атрибуты: название, телефон.
    1. **Пользователь** – субъект, осуществляющий покупку билетов. Атрибуты: логин, пароль, ФИО.
1) Основные REST методы:
    1. Регистрация нового пользователя (все логины пользователей уникальны).
    1. Получение списка всех доступных для покупки билетов, с возможностью пагинации (страница/размер) и фильтрации по следующим атрибутам:
        1. Дата/время
        1. Пункты отправления/назначения (вхождение по строке).
        1. Название перевозчика (вхождение по строке).
    1. Покупка определенного билета. Уже купленный билет не должен быть повторно доступен для покупки.
    1. Получение списка всех купленных билетов для текущего пользователя.
1) Все данные должны храниться в СУБД PostgreSQL.
1) Не разрешается использовать Hibernate/Spring Data для доступа к БД. Возможные варианты – JDBC, JdbcTemplate, JooQ и т.п.
1) Входные данные REST методов должны валидироваться. В случае ошибки валидации должна возвращаться HTTP ошибка 400, а в теле ответа – сообщение об ошибке (нужно придумать любой формат тела ответа, отличный от стандартного в Spring Web).
1) Необходимо наличие Swagger документации через аннотации в коде.
1) По желанию: возможна реализация с помощью Spring WebFlux вместо Spring Web.
1) Не обязательно: написать Dockerfile для создания Docker образа микросервиса

**Дополнительная задача 1**

1) Реализовать аутентификацию пользователей с помощью JWT токенов (access и refresh токены по типу OAuth 2). Access токен должен быть ограничен по времени действия.
1) Добавить методы для аутентификации уже зарегистрированных пользователей и обновления access токена по refresh токену.
1) При вызове основных методов с неверным токеном должна возвращаться HTTP ошибка 401.

**Дополнительная задача 2**

1) Добавить для пользователей сущность «Роль», которая подразделяется на «Покупатель» и «Администратор».
1) Добавить новые REST методы для управления (добавление/изменение/удаление) сущностей **Билет**, **Маршрут** и **Перевозчик**. Данные методы должны быть доступны только для пользователей с ролью «Администратор».
1) Для покупателей вызовы этих методов должны приводить к HTTP ошибке 403.

**Дополнительная задача 3 \***

1) Добавить кеширование купленных билетов для каждого пользователя в БД Redis.
1) При запросе купленных билетов для текущего пользователя список билетов должен сначала извлекаться из Redis. Если данные в Redis отсутствуют, должен производиться запрос в БД PostgreSQL и обновление данных в Redis.
1) При покупке билета данные в Redis должны обновляться.

**Дополнительная задача 4 \*\***

1) Добавить новый микросервис, который будет принимать данные о купленных билетах из топика Kafka и сохранять в отдельную таблицу в БД (тот же PostgreSQL или любую другую на выбор, например, NoSQL БД).
1) При покупке билета в основном микросервисе данные билета дополнительно отправляются в этот топик Kafka.



